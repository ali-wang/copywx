<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>H+ 后台主题UI框架 - 数据表格</title>
    <meta name="keywords" content="H+后台主题,后台bootstrap框架,会员中心主题,后台HTML,响应式后台">
    <meta name="description" content="H+是一个完全响应式，基于Bootstrap3最新版本开发的扁平化主题，她采用了主流的左右两栏式布局，使用了Html5+CSS3等现代技术">

    <link rel="shortcut icon" href="favicon.ico"> <link href="__public__/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="__public__/css/font-awesome.css?v=4.4.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="__public__/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
     <link href="__public__/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="__public__/css/animate.css" rel="stylesheet">
    <link href="__public__/css/style.css?v=4.1.0" rel="stylesheet">
    <!-- <link href="__public__/css/H-ui.min.css" rel="stylesheet"> -->

    <script src="__public__/js/jquery.min.js?v=2.1.4"></script>
    <script src="__public__/time/WdatePicker.js"></script>
    <style type="text/css">
        .wcent{ margin:0 auto; }
    </style>

     
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>基本 <small>分类，查找</small></h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#">
                                <i class="fa fa-wrench"></i>
                            </a>
                          <!--   <ul class="dropdown-menu dropdown-user">
                                <li><a href="table_data_tables.html#">选项1</a>
                                </li>
                                <li><a href="table_data_tables.html#">选项2</a>
                                </li>
                            </ul> -->
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">


                <form name="searchform" action="select_date" method="post">
                    <div class="text-c" style="width: 916px; margin:20px auto;">网站:
                            <span class="select-box inline">

                           
                           <!--  <input type="text" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm', minDate: '2008-03-08 11:30:00', maxDate: '2030-03-10 20:59:30' })" value="" id="datemin" class="input-text Wdate" style="width:150px;font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;" name="star">
                           至

                            <input type="text" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm', minDate: '2008-03-08 11:30:00', maxDate: '2030-03-10 20:59:30' })"  value="" id="datemax" class="input-text Wdate" style="width:150px;font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;" name="end"> -->

                            
                              {if ($wl_flag == 0)} 


                             <select class="select" id="web" name="web" style="width:250px; font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;">
                                
                                <option value="1">全部</option>
                                {volist name="url" id="vo"}
                                <option value="{$vo}">{$vo}</option>
                                {/volist}

                                <!-- <option value="全部3">全部2</option>
                                <option value="全部4">全部3</option> -->
                            </select>

                            </span> 日期范围：


                            <input type="text" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm', minDate: '2008-03-08 11:30:00', maxDate: '2030-03-10 20:59:30'} )" value="" id="datemin" class="input-text Wdate" style="width:150px;font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;" name="star" autocomplete="off">
                           至

                            <input type="text" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm', minDate: '2008-03-08 11:30:00', maxDate: '2030-03-10 20:59:30' })"  value="" id="datemax" class="input-text Wdate" style="width:150px;font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;" name="end" autocomplete="off">

                          <!--   搜索词：<input type="text" class="input-text" style="width:250px" placeholder="" id="keyword" name="keyword" value="" ondblclick="this.value='';">
 -->
                             {elseif $wl_flag == 1/}

                                  <select class="select" id="web" name="web" style="width:250px; font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;">
                                        {if ($datatime.url != 1)}
                                        <option value="{$datatime.url}">{$datatime.url}</option>
                                        {/if}
                                 <option value="1">全部</option>
                                {volist name="url" id="vo"}
                                     <option value="{$vo}">{$vo}</option>
                                {/volist}

                                <!-- <option value="全部3">全部2</option>
                                <option value="全部4">全部3</option> -->
                            </select>

                            </span> 日期范围：
                              <input type="text" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm', minDate: '2008-03-08 11:30:00', maxDate: '2030-03-10 20:59:30'} )" value="{$datatime.star}" id="datemin" class="input-text Wdate" style="width:150px;font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;" name="star" autocomplete="off">
                           至

                            <input type="text" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd HH:mm', minDate: '2008-03-08 11:30:00', maxDate: '2030-03-10 20:59:30' })"  value="{$datatime.end}" id="datemax" class="input-text Wdate" style="width:150px;font-size: 14px;height: 31px;line-height: 1.42857; padding: 4px;" name="end" autocomplete="off">

                             {/if}


                          <!--   搜索词：<input type="text" class="input-text" style="width:250px" placeholder="" id="keyword" name="keyword" value="" ondblclick="this.value='';">
 -->
                            <button type="submit" style="margin-left:50px;" class="btn btn-success" name="" ><i class="fa fa-vimeo"></i> 搜记录</button>
                            


                        </div>
                    </form>
                 
                        <button  style="margin-right:50px; " class="btn btn-success" name="" onclick='tableToExcel()'><i class="fa fa-vimeo"></i> 下载</button>
                   
                        <table class="table table-striped table-bordered table-hover dataTables-example">
                            <thead>
                                <tr>
                                    <th>编号</th>
                                    <th>链接</th>
                                    <th>搜索词</th>
                                    <th>复制内容</th>
                                    <th>复制方式</th> 
                                    <th>搜索平台</th>
                                    <th>设备</th>
                                   <!--  <th>词</th>
                                    <th>单元</th>
                                    <th>计划</th> -->
                                    <th>省</th>
                                    <th>市</th>
                                    <th>时间</th>
                                    <th>ip</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {if condition="($wl_flag == 0)"} 
                                    {volist name="datas" id="vo"}
                                        <tr class="gradeA">
                                           <td>{$vo.id}</td>
                                            <td>{$vo.location}</td>
                                            <td>{$vo.souword}</td>
                                            <td class="center">{$vo.copy_content}</td>
                                            <td class="center wcent">
                                                    {switch name="$vo.user_type"}
                                                        {case value="1"}<div class="btn btn-warning">长按</div>{/case}
                                                        {case value="2"}<div class="btn btn-primary">点击</div>{/case}
                                                        {default /}<div class="btn btn-success">识别</div>
                                                    {/switch}


                                                
                                            </td>
                                            <td class="center">{$vo.sourceType}</td>
                                            <td class="center">{$vo.equipment}</td>
                                            
                                            <td class="center">{$vo.region}</td>
                                            <td class="center">{$vo.city}</td>
                                            <td class="center">{$vo.time|date='Y-m-d H:i',###}</td>
                                            <td class="center">{$vo.user_ip}</td>
                                            <td class="center"> <div class="btn btn-danger" onclick="ajax(this,{$vo.id})">删除</div></td>
                                        </tr>
                                    {/volist}

                                   {elseif condition="($wl_flag == 1)"}

                                       {volist name="datas" id="vo"}
                                            <tr class="gradeA">
                                               <td>{$vo.id}</td>
                                                <td>{$vo.location}</td>
                                                <td>{$vo.souword}</td>
                                                <td class="center">{$vo.copy_content}</td>
                                                <td class="center wcent">
                                                    {switch name="$vo.user_type"}
                                                        {case value="1"}<div class="btn btn-warning">长按</div>{/case}
                                                        {case value="2"}<div class="btn btn-primary">点击</div>{/case}
                                                        {default /}<div class="btn btn-success">识别</div>
                                                    {/switch}
                                                </td>
                                                <td class="center">{$vo.sourceType}</td>
                                                <td class="center">{$vo.equipment}</td>
                                               
                                                <td class="center">{$vo.region}</td>
                                                <td class="center">{$vo.city}</td>
                                                <td class="center">{$vo.time|date='Y-m-d H:i',###}</td>
                                                <td class="center">{$vo.user_ip}</td>
                                                <td class="center"> <div class="btn btn-danger" onclick="ajax(this,{$vo.id})">删除</div></td>
                                            </tr>
                                        {/volist}

                                    {else /} 

                                    {/if}

                               
                                
                             
                            </tbody>
                            <tfoot>
                               <!--  <tr>
                                    <th>渲染引擎</th>
                                    <th>浏览器</th>
                                    <th>平台</th>
                                    <th>引擎版本</th>
                                    <th>CSS等级</th>
                                    <th>引擎版本</th>
                                    <th>CSS等级</th>
                                    <th>引擎版本</th>
                                    <th>CSS等级</th>
                                    <th>CSS等级</th>
                                    <th>CSS等级</th>
                                    <th>CSS等级</th>
                                    <th>CSS等级</th>
                                    <th>CSS等级</th>

                                </tr> -->
                                
                            </tfoot>
                        </table>

                    </div>
                </div>
            </div>
        </div>


       
    </div>

    <!-- 全局js -->
    <script src="__public__/js/jquery.min.js?v=2.1.4"></script>
    <script src="__public__/js/bootstrap.min.js?v=3.3.6"></script>



    <script src="__public__/js/plugins/jeditable/jquery.jeditable.js"></script>

    <!-- Data Tables -->
    <script src="__public__/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="__public__/js/plugins/dataTables/dataTables.bootstrap.js"></script>

    <!-- 自定义js -->
    <script src="__public__/js/content.js?v=1.0.0"></script>
    <script src="__public__/js/plugins/sweetalert/sweetalert.min.js"></script>

    <!-- Page-Level Scripts -->
    <script>
        $(document).ready(function () {
            $('.dataTables-example').dataTable({ "aaSorting" : [[0, "desc"]], "iDisplayLength" : 25});

			
			
            /* Init DataTables */
            var oTable = $('#editable').dataTable();

            /* Apply the jEditable handlers to the table */
            oTable.$('td').editable('../example_ajax.php', {
                "callback": function (sValue, y) {
                    var aPos = oTable.fnGetPosition(this);
                    oTable.fnUpdate(sValue, aPos[0], aPos[1]);
                },
                "submitdata": function (value, settings) {
                    return {
                        "row_id": this.parentNode.getAttribute('id'),
                        "column": oTable.fnGetPosition(this)[2]
                    };
                },

                "width": "90%",
                "height": "100%"
            });


        });

        function fnClickAddRow() {
            $('#editable').dataTable().fnAddData([
                "Custom row",
                "New row",
                "New row",
                "New row",
                "New row"]);

        }
    </script>

   
    <script> 
        //用户删除信息
     function ajax(obj,id){

                    swal({
                        title: "您确定要删除这条信息吗",
                        text: "删除后将无法恢复，请谨慎操作！",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "删除",
                        closeOnConfirm: false
                    }, function () {
                         $.ajax({
                               type: "post",
                               url: "user_del",
                               data: {'id':id},
                               dataType: "json",
                               success: function(msg){
                                    if(msg =='1'){                                     
                                        swal("删除成功！", "您已经永久删除了这条信息。", "success");
                                        $(obj).parents("tr").remove();
                                    }else{
                                        swal("删除失败！", "未删除这条信息。", "error");
                                    }
                                  
                                }
                            }); 
                    });
              

       
        }        

       

           
    </script>



<script>
        var arr = {:json_encode($datas)};

        for(var nums in arr){
            arr[nums]['time'] = timestampToTime(arr[nums]['time']);
			arr[nums]['hour'] = hourchange(arr[nums]['time']);
            arr[nums]['sign_id'] = "";
            //console.log(arr[nums]['user_type']);
            if(arr[nums]['user_type'] == 1 ){
                //arr['nums'].splice(starti,1,'点击')
                arr[nums]['user_type'] = '点击';
            }else if(arr[nums]['user_type'] == 2){
                arr[nums]['user_type'] = '复制';
            }else{}
           // console.log(arr[nums]['time']);
        }
   // console.log(arr);

	 function hourchange(str) {
        str = str.split(" ");
        var hour = str['1'].split(":");
        return hour['0'];
    }
	
     function timestampToTime(timestamp) {
            var date = new Date(timestamp * 1000); //时间戳为10位需*1000，时间戳为13位的话不需乘1000
            Y = date.getFullYear() + '-';
            M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
            D = change(date.getDate()) + ' ';
            h = change(date.getHours()) + ':';
            m = change(date.getMinutes()) + ':';
            s = change(date.getSeconds());
            return Y + M + D + h + m + s;
        }

    function change(t) {
            if (t < 10) {
                return "0" + t;
            } else {
                return t;
            }
        }
       

   function tableToExcel(){
      
      const jsonData =arr;
      //列标题，逗号隔开，每一个逗号就是隔开一个单元格
      let str = `编号,链接,搜索词,复制微信号,搜索平台,设备,操作方式,ip,关键词,计划,单元,省,市,时间,,时段\n`;
      //增加\t为了不让表格显示科学计数法或者其他格式
      for(let i = 0 ; i < jsonData.length ; i++ ){
        for(let item in jsonData[i]){

            str+=`${jsonData[i][item] + '\t'},`;     
        }
        str+='\n';
      }
      //encodeURIComponent解决中文乱码
      let uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
      //通过创建a标签实现
      let link = document.createElement("a");
      link.href = uri;
      //对下载的文件命名
      var myDate = new Date();
      var mytime= myDate.toLocaleString();  
      link.download =  "总表数据"+mytime+".csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }


</script>

</body>

</html>
